// NEC code generator
//--------------------------------------
// SyncStart = 9 ms
FLOAT NEC_SyncStart = 9m

// SyncEnd = 4,5 ms
FLOAT NEC_SyncEnd = 4.5m

// Coding duty 560 mks
FLOAT NEC_BitTime = 0.56m

// Log0 = 2T = 1,12 ms - 0.56
FLOAT NEC_Log0 = 1.12m - NEC_BitTime

// Log1 = 4T = 2,25 ms - 0.56
FLOAT NEC_Log1 = 2.25m - NEC_BitTime

// Top level
OUT = 0
SLEEP FOR 2000m

// Start preambula
GOSUB SENDSYNC

// Addr0 = 0x55
GOSUB SENDBIT1
GOSUB SENDBIT0
GOSUB SENDBIT1
GOSUB SENDBIT0
GOSUB SENDBIT1
GOSUB SENDBIT0
GOSUB SENDBIT1
GOSUB SENDBIT0

// Addr1 = ~Addr0 = 0xAA
GOSUB SENDBIT0
GOSUB SENDBIT1
GOSUB SENDBIT0
GOSUB SENDBIT1
GOSUB SENDBIT0
GOSUB SENDBIT1
GOSUB SENDBIT0
GOSUB SENDBIT1

// Data0 = 0xC3
GOSUB SENDBIT1
GOSUB SENDBIT1
GOSUB SENDBIT0
GOSUB SENDBIT0
GOSUB SENDBIT0
GOSUB SENDBIT0
GOSUB SENDBIT1
GOSUB SENDBIT1

// Data1 = ~Data0 = 0x3C
GOSUB SENDBIT0
GOSUB SENDBIT0
GOSUB SENDBIT1
GOSUB SENDBIT1
GOSUB SENDBIT1
GOSUB SENDBIT1
GOSUB SENDBIT0
GOSUB SENDBIT0

// End
GOSUB THEEND

//
SENDSYNC:
  OUT = 1
  SLEEP FOR NEC_SyncStart
  OUT = 0
  SLEEP FOR NEC_SyncEnd
RETURN

//
SENDBIT0:
  OUT = 1
  SLEEP FOR NEC_BitTime
  OUT = 0
  SLEEP FOR NEC_Log0
RETURN

//
SENDBIT1:
  OUT = 1
  SLEEP FOR NEC_BitTime
  OUT = 0
  SLEEP FOR NEC_Log1
RETURN

THEEND:
  // end of Tx
  OUT = 1
  SLEEP FOR NEC_BitTime
  OUT = 0

END
